---
layout: base
pagination:
  data: scorecard.index.stations
  size: 1
  alias: station
permalink: /scorecard/station/{{ station.id }}/
---

<style>
  .station-layout {
    display: flex;
    flex-wrap: wrap;
    gap: 1em;
  }
  .station-details,
  .station-map {
    flex: 1 1 45%;
    min-width: 300px;
  }
  @media(max-width: 768px) {
    .station-layout {
      flex-direction: column;
    }
  }
</style>
<div class="content">
  <div>
    <a href="/scorecard">Scorecard</a>
    >
    <a href="/scorecard/us-state/{{ station.state_abbr | slug }}/">{{ station.state_name }}</a>
    > {{ station.name }}
  </div>
  <h1>{{ station.name }}</h1>
  <div class="station-layout">
    <div class="station-details">
      <table>
        <tr>
          <th>ID</th>
          <td>{{ station.id }}</td>
        </tr>
        <tr>
          <th>State</th>
          <td>{{ station.state_name }}</td>
        </tr>
        {% if station.county %}
        <tr>
          <th>County</th>
          <td>{{ station.county }}</td>
        </tr>
        {% endif %}
        <tr>
          <th>Latitude</th>
          <td>{{ station.latitude }}</td>
        </tr>
        <tr>
          <th>Longitude</th>
          <td>{{ station.longitude }}</td>
        </tr>
        <tr>
          <th>Elevation</th>
          <td>{{ station.elev }} m</td>
        </tr>
        {% if station.wfo %}
        <tr>
          <th>WFO</th>
          <td>{{ station.wfo }}</td>
        </tr>
        {% endif %}
        {% if station.tzname %}
        <tr>
          <th>Timezone</th>
          <td>{{ station.tzname }}</td>
        </tr>
        {% endif %}
      </table>
    </div>
    <div class="station-map">
      <div
        id="map-container" style="width: 100%; max-width: 600px; overflow: hidden;"><!-- D3.js map will be rendered here -->
      </div>
    </div>
  </div>
  <div>
    <p class="small-note">
      Station and observation data are from
      <a href="/catalog/asos-parquet/">asos-parquet</a>. See
      <a href="/scorecard/observation-data/">observation data details</a>.
    </p>
  </div>
  <div class='responsive-flex'>
    <h2>Temperature</h2>
    <div>
      <input type="radio" id="temp_180" name="temp_window" value="180" checked>
      <label for="temp_180">180 days</label>
      <input type="radio" id="temp_90" name="temp_window" value="90">
      <label for="temp_90">90 days</label>
    </div>
  </div>
  <div id="temperature_2m-obs" class="scorecard-chart"></div>
  <div id="temperature_2m-score" class="scorecard-chart"></div>
  <div class='responsive-flex'>
    <h2>Precipitation</h2>
    <div>
      <input type="radio" id="precip_180" name="precip_window" value="180" checked>
      <label for="precip_180">180 days</label>
      <input type="radio" id="precip_90" name="precip_window" value="90">
      <label for="precip_90">90 days</label>
    </div>
  </div>
  <div id="precipitation_surface-obs" class="scorecard-chart"></div>
  <div id="precipitation_surface-score" class="scorecard-chart"></div>
</div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script>
  const station = {{ station | dump | safe }};
  const width = 600;
  const height = 400;
  const svg = d3
    .select("#map-container")
    .append("svg")
    .attr("viewBox", [0, 0, width, height])
    .attr("width", "100%")
    .attr("height", "auto")
    .attr("style", "max-width: 100%;");
  d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
    const state = topojson
      .feature(us, us.objects.states)
      .features
      .find(d => d.properties.name === station.state_name);
    if (! state) {
      console.error("Could not find state for station:", station);
      return;
    }
    let projection = d3.geoIdentity().reflectY(true);
    // Use Albers projection for Alaska and Hawaii
    if (station.state_abbr === "AK" || station.state_abbr === "HI") {
      projection = d3.geoAlbersUsa();
    }
    const path = d3.geoPath(projection);
    // Fit the projection to the state
    projection.fitExtent([
      [
        0, 0
      ],
      [
        width, height
      ]
    ], state);
    svg
      .append("g")
      .attr("fill", "#fff")
      .attr("stroke", "#000")
      .selectAll("path")
      .data([state])
      .join("path")
      .attr("d", path);
    svg
      .append("circle")
      .attr("cx", projection([station.longitude, station.latitude])[0])
      .attr("cy", projection([station.longitude, station.latitude])[1])
      .attr("r", 5)
      .attr("fill", "blue");
  });

</script>
<script type="module">
  import { renderRMSE, renderObs } from '/scorecard.js';
  const stationId = '{{ station.id }}';
  const charts = {
    temp: { obs: document.getElementById('temperature_2m-obs'), score: document.getElementById('temperature_2m-score'), variable: 'temperature_2m', windowDays: 180 },
    precip: { obs: document.getElementById('precipitation_surface-obs'), score: document.getElementById('precipitation_surface-score'), variable: 'precipitation_surface', windowDays: 180 },
  };
  function renderVar(kind) {
    const c = charts[kind];
    renderObs(c.obs, { station: stationId, variable: c.variable, windowDays: c.windowDays });
    renderRMSE(c.score, { variable: c.variable, stationIds: [stationId], windowDays: c.windowDays });
  }
  renderVar('temp');
  renderVar('precip');
  function setupRadio(kind) {
    document.querySelectorAll(`input[name="${kind}_window"]`).forEach(radio => {
      radio.addEventListener('change', () => {
        charts[kind].windowDays = Number(radio.value);
        renderVar(kind);
      });
    });
  }
  setupRadio('temp');
  setupRadio('precip');
</script>